(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{430:function(e,t,n){"use strict";n.r(t);var a=n(45),s=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"build-integration"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#build-integration"}},[e._v("#")]),e._v(" Build Integration")]),e._v(" "),n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#introduction"}},[e._v("Introduction")])]),n("li",[n("a",{attrs:{href:"#requirements"}},[e._v("Requirements")])]),n("li",[n("a",{attrs:{href:"#jenkins-configuration"}},[e._v("Jenkins Configuration")]),n("ul",[n("li",[n("a",{attrs:{href:"#license-key-as-secret-text"}},[e._v("License Key as Secret Text")])]),n("li",[n("a",{attrs:{href:"#jsparrow-config-file"}},[e._v("jSparrow Config File")])])])]),n("li",[n("a",{attrs:{href:"#pipeline-configuration"}},[e._v("Pipeline Configuration")]),n("ul",[n("li",[n("a",{attrs:{href:"#tools-configuration"}},[e._v("Tools Configuration")])]),n("li",[n("a",{attrs:{href:"#checkout-and-setting-a-flag"}},[e._v("Checkout and Setting a Flag")])]),n("li",[n("a",{attrs:{href:"#jsparrow-execution"}},[e._v("jSparrow Execution")])])])]),n("li",[n("a",{attrs:{href:"#end-result"}},[e._v("End Result")])])])]),n("p"),e._v(" "),n("h2",{attrs:{id:"introduction"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[e._v("#")]),e._v(" Introduction")]),e._v(" "),n("p",[e._v("Integrating the jSparrow Maven plugin into a build process has the advantage of automatically applying selected jSparrow rules in an already automated process.\nThe configuration is highly customizable and depends very much on the environment.\nHere it will be described how Jenkins builds are able to trigger jSparrow Maven plugin builds, depending on the Git branch of the commit. In this example, all builds on a "),n("em",[e._v("feature")]),e._v(" branch will trigger jSparrow.")]),e._v(" "),n("h2",{attrs:{id:"requirements"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#requirements"}},[e._v("#")]),e._v(" Requirements")]),e._v(" "),n("p",[e._v("This description assumes that the following components are available and correctly setup.")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://www.jenkins.io/download/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Jenkins"),n("OutboundLink")],1),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://plugins.jenkins.io/pipeline-maven/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Pipeline Maven Integration plugin"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/jenkinsci/stashnotifier-plugin/blob/release/1.x/readme.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("Bitbucket Server Notifier plugin"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://plugins.jenkins.io/ssh-agent/",target:"_blank",rel:"noopener noreferrer"}},[e._v("SSH Agent plugin"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("("),n("a",{attrs:{href:"https://www.jenkins.io/doc/book/pipeline/syntax/#declarative-pipeline",target:"_blank",rel:"noopener noreferrer"}},[e._v("Declarative"),n("OutboundLink")],1),e._v(") "),n("a",{attrs:{href:"https://www.jenkins.io/doc/book/pipeline/multibranch/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Multibranch Pipeline"),n("OutboundLink")],1)])])]),e._v(" "),n("li",[n("a",{attrs:{href:"https://hub.docker.com/r/atlassian/bitbucket-server/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Bitbucket"),n("OutboundLink")],1)])]),e._v(" "),n("h2",{attrs:{id:"jenkins-configuration"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-configuration"}},[e._v("#")]),e._v(" Jenkins Configuration")]),e._v(" "),n("p",[e._v("A jSparrow build requires a license key and a config file (jsparrow.yml) to be present. Both can be kept securely within Jenkins and then referenced by the pipeline.")]),e._v(" "),n("h3",{attrs:{id:"license-key-as-secret-text"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#license-key-as-secret-text"}},[e._v("#")]),e._v(" License Key as Secret Text")]),e._v(" "),n("p",[e._v("The jSparrow license key can be provided using the "),n("code",[e._v("-Dlicense=<license-key>")]),e._v(" parameter, as described in the "),n("RouterLink",{attrs:{to:"/maven/getting-started.html#plugin-goals"}},[e._v("Plugin Goals")]),e._v(". However, it might not be desirable to provide the key in plain text."),n("br"),e._v('\nWith the help of Jenkins "secret text" credentials, it is possible to never have the license key appear in the pipeline. Even in log statements the "secret text" will only appear as asterisks.')],1),e._v(" "),n("p",[e._v("Jenkins lets users add credentials either globally, or build pipeline specific. For one pipeline, there is no practical difference between one or the other.")]),e._v(" "),n("ol",[n("li",[e._v('Navigate to the "Add Credentials" either global or pipeline specific\n'),n("ul",[n("li",[e._v("Global: "),n("em",[e._v("Manage Jenkins")]),e._v(" -> "),n("em",[e._v("Manage Credentials")]),e._v(" -> "),n("em",[e._v("System")]),e._v(' (click on "Store") -> '),n("em",[e._v("Global credentials (unrestricted)")])]),e._v(" "),n("li",[e._v("Pipeline specific: [Your Pipeline] -> "),n("em",[e._v("Credentials")]),e._v(" -> "),n("em",[e._v("Stores scoped to [Your Pipeline]")]),e._v(" -> "),n("em",[e._v("Global credentials (unrestricted)")])])])]),e._v(" "),n("li",[e._v("This is a description of the fields of the following screen:"),n("br"),e._v(" "),n("a",{attrs:{href:"/img/maven/jenkins-jsparrow-license.png"}},[n("img",{attrs:{src:"/img/maven/jenkins-jsparrow-license.png",alt:"jSparrow license"}})]),e._v(" "),n("ul",[n("li",[e._v('Kind: Select "Secret text"')]),e._v(" "),n("li",[e._v('Scope: This needs to be "Global", otherwise the pipeline will not have access')]),e._v(" "),n("li",[e._v("Secret: This is where the jSparrow license key has to be provided."),n("br"),e._v("\nNote: The content of this variable cannot be viewed anymore after putting it here and it will not appear in logs or echo statements.")]),e._v(" "),n("li",[e._v("ID: This is the key with which the secret text can be referenced in the pipeline")]),e._v(" "),n("li",[e._v("Description: It is always a good practice to provide a description")])])])]),e._v(" "),n("h3",{attrs:{id:"jsparrow-config-file"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jsparrow-config-file"}},[e._v("#")]),e._v(" jSparrow Config File")]),e._v(" "),n("p",[e._v("Customization about which rules to apply or which resources to skip are done in a config file ("),n("code",[e._v("jsparrow.yml")]),e._v("), as described in detail in "),n("RouterLink",{attrs:{to:"/maven/getting-started.html#plugin-configuration"}},[e._v("Plugin Configuration")]),e._v(".")],1),e._v(" "),n("p",[e._v("By default, this configuration file is expected to reside in the project's root directory. Alternatively, there is the option to fully manage the jSparrow configuration in Jenkins. This might have the following advantages:")]),e._v(" "),n("ul",[n("li",[e._v("The "),n("code",[e._v("jsparrow.yml")]),e._v(" does not need to be committed to the project's SCM repository")]),e._v(" "),n("li",[e._v("Jenkins administrators can manage the configuration globally")])]),e._v(" "),n("p",[e._v("The config file can be added as follows:")]),e._v(" "),n("ol",[n("li",[e._v("Navigate to "),n("em",[e._v("Manage Jenkins")]),e._v(" -> "),n("em",[e._v("Managed files")]),e._v(' and click "Add a new Config"')]),e._v(" "),n("li",[e._v('Add a new "Custom file" and provide a meaningful ID')]),e._v(" "),n("li",[e._v("This is a description of the fields of the following screen:"),n("br"),e._v(" "),n("a",{attrs:{href:"/img/maven/jenkins-jsparrow-yml-content.png"}},[n("img",{attrs:{src:"/img/maven/jenkins-jsparrow-yml-content.png",alt:"jsparrow.yml"}})]),e._v(" "),n("ul",[n("li",[e._v("ID: The key with which the file will be referenced within the pipeline")]),e._v(" "),n("li",[e._v("Name: The file name")]),e._v(" "),n("li",[e._v("Comment: An optional description")]),e._v(" "),n("li",[e._v("Content: The configuration according to the "),n("RouterLink",{attrs:{to:"/maven/getting-started.html#plugin-configuration"}},[e._v("Plugin Configuration")])],1)])])]),e._v(" "),n("h2",{attrs:{id:"pipeline-configuration"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pipeline-configuration"}},[e._v("#")]),e._v(" Pipeline Configuration")]),e._v(" "),n("p",[e._v("With "),n("a",{attrs:{href:"https://www.jenkins.io/doc/book/pipeline/multibranch/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Multibranch Pipelines"),n("OutboundLink")],1),e._v(", Jenkins offers a way to run builds on all branches of a repository. This is very useful when following a branching model, such as "),n("a",{attrs:{href:"https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow",target:"_blank",rel:"noopener noreferrer"}},[e._v("Gitflow"),n("OutboundLink")],1),e._v(", where different types of branches have different purposes. The current branch can be determined during runtime ("),n("code",[e._v("env.BRANCH_NAME")]),e._v(" or via "),n("a",{attrs:{href:"https://www.jenkins.io/doc/book/pipeline/syntax/#built-in-conditions",target:"_blank",rel:"noopener noreferrer"}},[e._v("Built-in Condition"),n("OutboundLink")],1),e._v("), making it possible to process certain branches differently.")]),e._v(" "),n("p",[e._v("In this example, a declarative Multibranch Pipeline will be configured to run the jSparrow Maven plugin on "),n("em",[e._v("feature")]),e._v(" branches. In Gitflow, a "),n("em",[e._v("feature")]),e._v(" branch should only be merged into "),n("em",[e._v("develop")]),e._v(" (and "),n("em",[e._v("master")]),e._v(") after being reviewed in a pull request.")]),e._v(" "),n("p",[e._v("Here, the necessary pipeline file will be described one part at a time. Click on "),n("a",{attrs:{href:"https://gist.github.com/luigiwerzowa/aafba402bd36faa573f48a26fc056289",target:"_blank",rel:"noopener noreferrer"}},[e._v("Jenkinsfile.groovy"),n("OutboundLink")],1),e._v(" for the full file.")]),e._v(" "),n("h3",{attrs:{id:"tools-configuration"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tools-configuration"}},[e._v("#")]),e._v(" Tools Configuration")]),e._v(" "),n("p",[e._v("Both the Maven and JDK version have to be specified for the build.")]),e._v(" "),n("div",{staticClass:"language-groovy extra-class"},[n("pre",{pre:!0,attrs:{class:"language-groovy"}},[n("code",[e._v("tools "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  jdk "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("'JDK8'")]),e._v("\n  maven "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("'maven3'")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),n("p",[e._v("The referenced names ("),n("code",[e._v("JDK8")]),e._v(" and "),n("code",[e._v("maven3")]),e._v(") have to point to a corresponding configuration in "),n("em",[e._v("Manage Jenkins")]),e._v(" -> "),n("em",[e._v("Global Tool Configuration")]),e._v(", as seen in the example below.\n"),n("a",{attrs:{href:"/img/maven/jenkins-tools-maven.png"}},[n("img",{attrs:{src:"/img/maven/jenkins-tools-maven.png",alt:"Maven integration"}})])]),e._v(" "),n("h3",{attrs:{id:"checkout-and-setting-a-flag"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#checkout-and-setting-a-flag"}},[e._v("#")]),e._v(" Checkout and Setting a Flag")]),e._v(" "),n("p",[e._v("The purpose of this step is to checkout the current commit, to check if the last commit was done by jSparrow and to set a flag if that has been the case.")]),e._v(" "),n("p",[e._v("A declarative pipeline automatically creates a checkout stage by default. To avoid that, we use the option "),n("code",[e._v("skipDefaultCheckout true")]),e._v(" and create our own checkout stage.")]),e._v(" "),n("div",{staticClass:"language-groovy extra-class"},[n("pre",{pre:!0,attrs:{class:"language-groovy"}},[n("code",[e._v("options "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  skipDefaultCheckout "),n("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\nenvironment "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  JSPARROW_FLAG "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\nstages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Checkout'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      checkout scm\n      script "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        result "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" sh "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("script"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[e._v("\"git log -1 --pretty=%B | grep '\\\\[jSparrow\\\\]'\"")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" returnStatus"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("result "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n          JSPARROW_FLAG "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),e._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n        echo "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[e._v('"jSparrow flag: "')]),e._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+")]),e._v(" JSPARROW_FLAG\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("...")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),n("p",[e._v("In order to avoid endless build loops, a flag ("),n("code",[e._v("JSPARROW_FLAG")]),e._v(") is set to "),n("code",[e._v("false")]),e._v(" whenever the current commit has been done by jSparrow. In this example, the flag is set whenever the commit message contains "),n("code",[e._v("[jSparrow]")]),e._v(".")]),e._v(" "),n("h3",{attrs:{id:"jsparrow-execution"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jsparrow-execution"}},[e._v("#")]),e._v(" jSparrow Execution")]),e._v(" "),n("p",[e._v("This step can be split into three main parts:")]),e._v(" "),n("ol",[n("li",[e._v("Deciding on whether or not to trigger jSparrow")]),e._v(" "),n("li",[e._v("Executing jSparrow")]),e._v(" "),n("li",[e._v("Pushing the changes to Git")])]),e._v(" "),n("h4",{attrs:{id:"whether-or-not-to-trigger-jsparrow"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#whether-or-not-to-trigger-jsparrow"}},[e._v("#")]),e._v(" Whether or Not to Trigger jSparrow")]),e._v(" "),n("p",[e._v("By default, all conditions within a "),n("a",{attrs:{href:"https://www.jenkins.io/doc/book/pipeline/syntax/#when",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("when")]),e._v(" directive"),n("OutboundLink")],1),e._v(" must be true in order for the stage to be executed.")]),e._v(" "),n("div",{staticClass:"language-groovy extra-class"},[n("pre",{pre:!0,attrs:{class:"language-groovy"}},[n("code",[e._v("when "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// only execute on feature branches..")]),e._v("\n  branch pattern"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[e._v('"feature/.*"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" comparator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[e._v('"REGEXP"')]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ..and if the JSPARROW_FLAG is still true")]),e._v("\n  expression "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    JSPARROW_FLAG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("toBoolean")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),n("p",[e._v("The purpose of this "),n("code",[e._v("when")]),e._v(" condition is to make sure that the current branch is a "),n("em",[e._v("feature")]),e._v(" branch and that the flag is still true.")]),e._v(" "),n("h4",{attrs:{id:"executing-jsparrow"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#executing-jsparrow"}},[e._v("#")]),e._v(" Executing jSparrow")]),e._v(" "),n("p",[e._v("In this step we make use of the previously defined "),n("code",[e._v("JSPARROW_LICENSE")]),e._v(" (see "),n("RouterLink",{attrs:{to:"/maven/build-integration.html#license-key-as-secret-text"}},[e._v("License Key as Secret Text")]),e._v(") and "),n("code",[e._v("JSPARROW_CONFIG")]),e._v(" (see "),n("RouterLink",{attrs:{to:"/maven/build-integration.html#jsparrow-config-file"}},[e._v("jSparrow Config File")]),e._v(").")],1),e._v(" "),n("div",{staticClass:"language-groovy extra-class"},[n("pre",{pre:!0,attrs:{class:"language-groovy"}},[n("code",[e._v("environment "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  JSPARROW_LICENSE "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("credentials")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("'JSPARROW_LICENSE'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\nsteps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// make the jsparrow.yml available with via configFileProvider")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("configFileProvider")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("configFile")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("fileId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("'JSPARROW_CONFIG'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" targetLocation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/tmp/jsparrow.yml'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\n    sh "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[e._v('"mvn jsparrow:refactor -Dlicense='),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("$")]),e._v("JSPARROW_LICENSE")]),e._v(' -DconfigFile=/tmp/jsparrow.yml"')]),e._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("...")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),n("p",[e._v("A declarative pipeline offers an "),n("a",{attrs:{href:"https://www.jenkins.io/doc/book/pipeline/syntax/#environment",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("environment")]),e._v(" directive"),n("OutboundLink")],1),e._v(" to access credentials (e.g., a secret text) and set the content to an environment variable ("),n("code",[e._v("JSPARROW_LICENSE")]),e._v("). This environment variable is then accessed within a shell command ("),n("code",[e._v("sh")]),e._v(") by using a dollar sign: "),n("code",[e._v("$JSPARROW_LICENSE")]),e._v(".")]),e._v(" "),n("p",[e._v("The "),n("a",{attrs:{href:"https://www.jenkins.io/doc/pipeline/steps/config-file-provider/#configfileprovider-provide-configuration-files",target:"_blank",rel:"noopener noreferrer"}},[n("code",[e._v("configFileProvider")]),e._v(" plugin"),n("OutboundLink")],1),e._v(" is used to make the "),n("code",[e._v("JSPARROW_CONFIG")]),e._v(" file available to the build in a local path. Here, the config file is placed into "),n("code",[e._v("/tmp/jsparrow.yml")]),e._v(". This path is then passed to the jSparrow execution.")]),e._v(" "),n("p",[e._v("All that remains is to call the "),n("RouterLink",{attrs:{to:"/maven/getting-started.html#refactor"}},[n("code",[e._v("jsparrow:refactor")]),e._v(" goal")]),e._v(" with the two resouces.")],1),e._v(" "),n("h4",{attrs:{id:"pushing-the-changes-to-git"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pushing-the-changes-to-git"}},[e._v("#")]),e._v(" Pushing the Changes to Git")]),e._v(" "),n("p",[e._v("After running jSparrow, the changes have to be committed and pushed to the original repository, in order for the changes to be persisted.")]),e._v(" "),n("p",[e._v("As long as the "),n("code",[e._v("GitPublisher")]),e._v(" plugin does not support pushing (see "),n("a",{attrs:{href:"https://issues.jenkins-ci.org/browse/JENKINS-28335",target:"_blank",rel:"noopener noreferrer"}},[e._v("JENKINS-28335"),n("OutboundLink")],1),e._v("), a workaround is required for pushing changes. The "),n("a",{attrs:{href:"https://plugins.jenkins.io/ssh-agent/",target:"_blank",rel:"noopener noreferrer"}},[e._v("SSH Agent plugin"),n("OutboundLink")],1),e._v(" can make use of already defined SSH credentials and will therefore be used in this example.")]),e._v(" "),n("div",{staticClass:"language-groovy extra-class"},[n("pre",{pre:!0,attrs:{class:"language-groovy"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[e._v("sshagent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("'SSH_KEY_ID'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  sh "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[e._v("\"git config user.name 'jSparrow'\"")]),e._v("\n  sh "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[e._v("\"git config user.email 'info@jsparrow.io'\"")]),e._v("\n  sh "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[e._v('"git add --all"')]),e._v("\n  sh "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[e._v("\"git commit -m '[jSparrow] automatic refactoring'\"")]),e._v("\n  sh "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[e._v('"git push origin HEAD:'),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("$")]),e._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("BRANCH_NAME")]),e._v('"')]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),n("ol",[n("li",[e._v("The "),n("code",[e._v("sshagent")]),e._v(" references an SSH key by ID. See the following screenshots as reference:\n"),n("a",{attrs:{href:"/img/maven/jenkins-config-ssh.png"}},[n("img",{attrs:{src:"/img/maven/jenkins-config-ssh.png",alt:"add ssh key to jenkins"}})])]),e._v(" "),n("li",[e._v("Note: The commit message contains "),n("code",[e._v("[jSparrow]")]),e._v(". This is used as an indicator to set the "),n("code",[e._v("JSPARROW_FLAG")]),e._v(" (see "),n("RouterLink",{attrs:{to:"/maven/build-integration.html#checkout-and-setting-a-flag"}},[e._v("Checkout and Setting a Flag\n")]),e._v(").")],1),e._v(" "),n("li",[e._v("Jenkins always checks out single commits as "),n("em",[e._v("detached HEAD")]),e._v(". For this reason, we need to specify the branch to push to. Jenkins provides an environment variable "),n("code",[e._v("env.BRANCH_NAME")]),e._v(", which makes it easy to determine the refspec destination.")])]),e._v(" "),n("h2",{attrs:{id:"end-result"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#end-result"}},[e._v("#")]),e._v(" End Result")]),e._v(" "),n("p",[e._v("In the end, the pipeline should be triggered whenever both of the following conditions are met:")]),e._v(" "),n("ol",[n("li",[e._v("The commit in question is done on a "),n("em",[e._v("feature")]),e._v(" branch.")]),e._v(" "),n("li",[e._v("The commit in question is not done by a jSparrow refactoring (i.e., the commit message does not contain "),n("code",[e._v("[jSparrow]")]),e._v(").")])]),e._v(" "),n("p",[e._v("The screenshot below shows an example of a "),n("em",[e._v("feature")]),e._v(" branch commit triggering jSparrow, followed by a "),n("code",[e._v("[jSparrow]")]),e._v(" commit, which skips the jSparrow step.")]),e._v(" "),n("p",[n("a",{attrs:{href:"/img/maven/jenkins-jsparrow-run.png"}},[n("img",{attrs:{src:"/img/maven/jenkins-jsparrow-run.png",alt:"jSparrow Refactoring"}})])])])}),[],!1,null,null,null);t.default=s.exports}}]);